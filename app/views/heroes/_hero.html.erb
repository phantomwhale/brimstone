<div id="<%= dom_id hero %>" class="hero-sheet max-w-4xl mx-auto">
  <%# Header Section %>
  <header class="sheet-header">
    <div class="flex-1">
      <div class="flex items-center gap-2 mb-2">
        <span class="font-serif font-bold text-parchment-light">Name:</span>
        <span class="font-body text-xl text-gold"><%= hero.name %></span>
      </div>
      <div class="flex items-center gap-2">
        <span class="font-serif font-bold text-parchment-light text-sm">Class:</span>
        <span class="font-body text-lg text-parchment-light"><%= hero.hero_class&.titleize&.gsub('_', ' ') %></span>
      </div>
    </div>
    <div class="sheet-header-title">
      <h1>Shadows of Brimstone</h1>
      <h2>Hero Sheet</h2>
    </div>
  </header>

  <div class="grid grid-cols-1 md:grid-cols-[240px_1fr] gap-6 p-6">
    <%# Left Column: Portrait Area %>
    <aside class="flex flex-col gap-4">
      <div class="portrait-frame">
        <% if hero.portrait.present? %>
          <%= image_tag "portraits/#{hero.portrait}.jpg", class: "portrait-image", alt: portrait_display_name(hero.portrait) %>
        <% else %>
          <div class="portrait-placeholder">
            <span>No Portrait</span>
          </div>
        <% end %>
      </div>
      <div class="info-box">
        <h3 class="info-box-title">Keywords</h3>
        <div class="min-h-[40px] text-center text-sm text-parchment-border italic">
          <em>No keywords assigned</em>
        </div>
      </div>
    </aside>

    <%# Main Stats Area %>
    <main class="flex flex-col gap-5">
      <%# Top row: Attributes + Initiative/Corruption %>
      <div class="flex gap-4">
        <%# Core Attributes (6 stats in 2 rows of 3) %>
        <section class="attributes-section flex-1">
          <div class="grid grid-cols-3 gap-4 mb-4">
            <% [
              ['Agility', 'agility'],
              ['Cunning', 'cunning'],
              ['Spirit', 'spirit']
            ].each do |attr_name, attr_key| %>
              <div class="flex flex-col items-center gap-2">
                <span class="attribute-label"><%= attr_name %></span>
                <div class="attribute-display <%= adjustment_indicator_class(hero, attr_key) %>">
                  <%= hero.adjusted_value_for(attr_key) %>
                  <% if (adj = adjustment_amount(hero, attr_key)) %>
                    <span class="adjustment-indicator"><%= adj %></span>
                  <% end %>
                </div>
              </div>
            <% end %>
          </div>
          <div class="grid grid-cols-3 gap-4">
            <% [
              ['Strength', 'strength'],
              ['Lore', 'lore'],
              ['Luck', 'luck']
            ].each do |attr_name, attr_key| %>
              <div class="flex flex-col items-center gap-2">
                <span class="attribute-label"><%= attr_name %></span>
                <div class="attribute-display <%= adjustment_indicator_class(hero, attr_key) %>">
                  <%= hero.adjusted_value_for(attr_key) %>
                  <% if (adj = adjustment_amount(hero, attr_key)) %>
                    <span class="adjustment-indicator"><%= adj %></span>
                  <% end %>
                </div>
              </div>
            <% end %>
          </div>
        </section>

        <%# Initiative & Corruption (stacked on right) %>
        <div class="flex flex-col gap-4">
          <div class="initiative-box">
            <span class="font-western text-xs text-parchment-light uppercase">Initiative</span>
            <div class="initiative-display <%= adjustment_indicator_class(hero, 'initiative') %>">
              <%= hero.adjusted_initiative %>
              <% if (adj = adjustment_amount(hero, 'initiative')) %>
                <span class="adjustment-indicator"><%= adj %></span>
              <% end %>
            </div>
          </div>
          <div class="corruption-box">
            <span class="font-western text-[10px] text-parchment-light uppercase text-center leading-tight">Corruption Resistance</span>
            <div class="corruption-display <%= adjustment_indicator_class(hero, 'corrupt_resist') %>">
              <%= hero.adjusted_corrupt_resist %>
              <% if (adj = adjustment_amount(hero, 'corrupt_resist')) %>
                <span class="adjustment-indicator"><%= adj %></span>
              <% end %>
            </div>
          </div>
        </div>
      </div>

      <%# Combat Stats Section %>
      <section class="combat-section">
        <div class="flex flex-wrap gap-6 items-start">
          <div>
            <h3 class="font-western text-base text-wood-dark mb-3">To Hit:</h3>
            <div class="flex gap-6">
              <div class="flex flex-col items-center gap-2">
                <span class="font-serif text-sm font-bold text-wood-dark">Ranged</span>
                <div class="to-hit-display">
                  <%= format_dice_target(hero.range_to_hit) %>
                </div>
              </div>
              <div class="flex flex-col items-center gap-2">
                <span class="font-serif text-sm font-bold text-wood-dark">Melee</span>
                <div class="to-hit-display">
                  <%= format_dice_target(hero.melee_to_hit) %>
                </div>
              </div>
            </div>
          </div>
          <div class="flex flex-col gap-3">
            <div class="flex items-center gap-2 bg-parchment-light border-2 border-wood rounded-md px-3 py-2">
              <span class="font-serif text-sm font-bold text-wood-dark whitespace-nowrap">Combat:</span>
              <div class="combat-display <%= adjustment_indicator_class(hero, 'combat') %>">
                <%= hero.adjusted_combat %>
                <% if (adj = adjustment_amount(hero, 'combat')) %>
                  <span class="adjustment-indicator"><%= adj %></span>
                <% end %>
              </div>
            </div>
            <div class="flex items-center gap-2 bg-parchment-light border-2 border-wood rounded-md px-3 py-2">
              <span class="font-serif text-sm font-bold text-wood-dark whitespace-nowrap">Max Grit:</span>
              <div class="combat-display <%= adjustment_indicator_class(hero, 'max_grit') %>">
                <%= hero.adjusted_max_grit %>
                <% if (adj = adjustment_amount(hero, 'max_grit')) %>
                  <span class="adjustment-indicator"><%= adj %></span>
                <% end %>
              </div>
            </div>
          </div>
        </div>
      </section>

      <%# Health and Sanity Section %>
      <section class="grid grid-cols-1 sm:grid-cols-2 gap-6">
        <div class="health-section">
          <div class="font-western text-lg text-parchment-light uppercase text-center mb-3" style="text-shadow: 1px 1px 2px rgba(0,0,0,0.5);">
            Health
          </div>
          <div class="flex items-center gap-4">
            <div class="health-display <%= adjustment_indicator_class(hero, 'health') %>">
              <%= hero.adjusted_health %>
              <% if (adj = adjustment_amount(hero, 'health')) %>
                <span class="adjustment-indicator"><%= adj %></span>
              <% end %>
            </div>
            <div class="flex flex-col items-center gap-1">
              <span class="font-serif text-xs text-parchment-light uppercase">Defense</span>
              <div class="defense-display">
                <%= format_dice_target(hero.defense) %>
              </div>
            </div>
          </div>
        </div>
        <div class="sanity-section">
          <div class="font-western text-lg text-parchment-light uppercase text-center mb-3" style="text-shadow: 1px 1px 2px rgba(0,0,0,0.5);">
            Sanity
          </div>
          <div class="flex items-center gap-4">
            <div class="sanity-display <%= adjustment_indicator_class(hero, 'sanity') %>">
              <%= hero.adjusted_sanity %>
              <% if (adj = adjustment_amount(hero, 'sanity')) %>
                <span class="adjustment-indicator"><%= adj %></span>
              <% end %>
            </div>
            <div class="flex flex-col items-center gap-1">
              <span class="font-serif text-xs text-parchment-light uppercase">Willpower</span>
              <div class="willpower-display">
                <%= format_dice_target(hero.willpower) %>
              </div>
            </div>
          </div>
        </div>
      </section>

      <%# Resources Section %>
      <section class="resources-section">
        <h3 class="font-western text-lg text-wood-dark text-center border-b-2 border-parchment-border pb-2 mb-4">
          Resources
        </h3>
        <div class="grid grid-cols-2 sm:grid-cols-3 gap-4">
          <div class="flex flex-col items-center gap-2">
            <span class="font-serif text-sm font-bold text-wood-dark text-center">Experience</span>
            <div class="resource-display"><%= hero.experience %></div>
          </div>
          <div class="flex flex-col items-center gap-2">
            <span class="font-serif text-sm font-bold text-wood-dark text-center">Gold</span>
            <div class="resource-display gold"><%= hero.gold %></div>
          </div>
          <div class="flex flex-col items-center gap-2">
            <span class="font-serif text-sm font-bold text-wood-dark text-center">Dark Stone</span>
            <div class="resource-display darkstone"><%= hero.dark_stone %></div>
          </div>
        </div>
      </section>
      
      <%# Side Bag Section %>
      <section class="sidebag-section-display">
        <div class="flex items-center justify-between border-b-2 border-parchment-border pb-2 mb-4">
          <h3 class="font-western text-lg text-wood-dark">Side Bag</h3>
          <span class="font-serif text-sm text-wood-dark">
            <%= hero.sidebag_count %> / <%= hero.adjusted_sidebag_capacity %> tokens
            <% if hero.has_adjustment_for?('sidebag_capacity') %>
              <span class="text-xs <%= hero.total_adjustment_for('sidebag_capacity') > 0 ? 'text-green-700' : 'text-red-500' %>">
                (<%= adjustment_amount(hero, 'sidebag_capacity') %>)
              </span>
            <% end %>
          </span>
        </div>
        
        <% if hero.sidebag_tokens.any? %>
          <div class="sidebag-tokens-display">
            <% hero.sidebag_tokens.each do |token| %>
              <div class="sidebag-token-display" title="<%= token_display_name(token) %>">
                <%= image_tag "tokens/sidebag/#{token}.png", alt: token_display_name(token), class: "sidebag-token-image-display" %>
                <span class="sidebag-token-name-display"><%= token_display_name(token) %></span>
              </div>
            <% end %>
          </div>
        <% else %>
          <div class="text-center text-parchment-border italic py-4">
            No tokens in side bag
          </div>
        <% end %>
      </section>
    </main>
  </div>

  <%# Adjustments Section %>
  <div class="p-6 pt-0">
    <section class="adjustments-section">
      <div class="flex items-center justify-between border-b-2 border-parchment-border pb-2 mb-4">
        <h3 class="font-western text-lg text-wood-dark">Adjustments</h3>
        <span class="font-serif text-sm text-wood-dark">
          <%= hero.adjustments.active.count %> active / <%= hero.adjustments.count %> total
        </span>
      </div>
      
      <div id="adjustments-list" class="adjustments-list">
        <% if hero.adjustments.any? %>
          <%= render hero.adjustments.order(active: :desc, created_at: :desc) %>
        <% else %>
          <div class="text-center text-parchment-border italic py-4" id="no-adjustments-message">
            No adjustments yet
          </div>
        <% end %>
      </div>
      
      <div class="mt-4">
        <%= render "adjustments/form", hero: hero, adjustment: hero.adjustments.build %>
      </div>
    </section>
  </div>

  <%# Bottom Sections: Items & Abilities %>
  <div class="p-6 pt-0 grid grid-cols-1 lg:grid-cols-2 gap-6">
    <div class="info-box">
      <h3 class="font-western text-lg text-wood-dark text-center border-b-2 border-parchment-border pb-2 mb-4">Items</h3>
      <div class="text-sm text-parchment-border mb-2 text-center">Personal Items / Upgrades / Clothing</div>
      <div class="bg-white/50 border border-parchment-border rounded p-3 min-h-[80px]">
        <div class="text-sm text-parchment-border italic text-center">No items assigned</div>
      </div>
    </div>

    <div class="info-box">
      <h3 class="font-western text-lg text-wood-dark text-center border-b-2 border-parchment-border pb-2 mb-4">Abilities</h3>
      <div class="text-sm text-parchment-border mb-2 text-center">Starting Upgrades</div>
      <div class="bg-white/50 border border-parchment-border rounded p-3 min-h-[80px]">
        <div class="text-sm text-parchment-border italic text-center">No abilities assigned</div>
      </div>
    </div>
  </div>

  <%# Injuries/Madness/Mutations Section %>
  <div class="p-6 pt-0 grid grid-cols-1 lg:grid-cols-2 gap-6">
    <div class="injuries-section">
      <h3 class="font-western text-lg text-parchment-light text-center border-b-2 border-health-border pb-2 mb-4">Injuries / Madness</h3>
      <div class="bg-parchment-light/20 border border-health-border rounded p-3 min-h-[60px]">
        <div class="text-sm text-parchment-light/70 italic text-center">No injuries or madness</div>
      </div>
    </div>

    <div class="mutations-section">
      <h3 class="font-western text-lg text-parchment-light text-center border-b-2 border-purple-800 pb-2 mb-4">Mutations</h3>
      <div class="bg-parchment-light/20 border border-purple-800 rounded p-3 min-h-[60px]">
        <div class="text-sm text-parchment-light/70 italic text-center">No mutations</div>
      </div>
    </div>
  </div>
</div>
